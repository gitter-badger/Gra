<?php

namespace HempEmpire;

use Illuminate\Database\Eloquent\Model;

class Timer extends Model {
	protected $fillable = ['owner_id', 'owner_type', 'start', 'end', 'name'];
	public $timestamps  = false;

	public function owner() {
		return $this->morphTo();
	}

	public function getStartAttribute($value) {
		return strtotime($value);
	}

	public function setStartAttribute($value) {
		if (is_numeric($value)) {
			$value = date('Y-m-d H:i:s', $value);
		}

		$this->attributes['start'] = $value;
	}

	public function getEndAttribute($value) {
		return strtotime($value);
	}

	public function setEndAttribute($value) {
		if (is_numeric($value)) {
			$value = date('Y-m-d H:i:s', $value);
		}

		$this->attributes['end'] = $value;
	}

	public function getActiveAttribute() {
		$now = time();
		return $this->start <= $now && $this->end > $now;
	}

	public function scopeActive($query) {
		$now = date('Y-m-d H:i:s');
		return $query->where('start', '<=', $now)
		             ->where('end', '>', $now);
	}

}
