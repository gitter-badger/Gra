<?php

namespace HempEmpire\Jobs;

use HempEmpire\Jobs\Job;
use HempEmpire\User;
use Illuminate\Contracts\Bus\SelfHandling;
use Illuminate\Contracts\Queue\ShouldQueue;

use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Queue\SerializesModels;
use Mail;

class SendVerification extends Job implements SelfHandling, ShouldQueue {
	use InteractsWithQueue, SerializesModels;

	private $user;

	/**
	 * Create a new job instance.
	 *
	 * @return void
	 */
	public function __construct(User $user) {
		$this->user = $user;
	}

	/**
	 * Execute the job.
	 *
	 * @return void
	 */
	public function handle() {
		echo __METHOD__ .PHP_EOL;
		$data = [

			'email' => $this->user->email,
			'ip'    => $this->user->registration_ip,
			'date'  => $this->user->created_at,
			'token' => $this->user->token,
		];

		Mail::send('emails.verification', $data, function ($message) {
				$message->to($this->user->email)->subject('Account verification');
			});
	}
}
